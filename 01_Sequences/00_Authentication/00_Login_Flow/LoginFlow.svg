<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1518px" preserveAspectRatio="none" style="width:1113px;height:1518px;background:#FFFFFF;" version="1.1" viewBox="0 0 1113 1518" width="1113px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="60" x="528" y="27.9951">ログイン</text><rect fill="#FFFFFF" height="1278.7188" style="stroke:#181818;stroke-width:1.0;" width="10" x="299" y="149.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="544" y="616.3906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="544" y="718.9219"/><rect fill="#FFFFFF" height="57.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="163.7266"/><rect fill="#FFFFFF" height="204.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="826.3203"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="1183.7813"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="1328.3125"/><rect fill="#FFFFFF" height="176.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="765" y="840.3203"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="765" y="1342.3125"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="893" y="192.8594"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="1022" y="1197.7813"/><rect fill="none" height="478.0625" style="stroke:#000000;stroke-width:1.5;" width="589.5" x="10" y="320.125"/><rect fill="none" height="186.7344" style="stroke:#000000;stroke-width:1.5;" width="520" x="20" y="386.3906"/><rect fill="none" height="332.1953" style="stroke:#000000;stroke-width:1.5;" width="1087" x="20" y="1088.25"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="54" x2="54" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="303.5" x2="303.5" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="548.5" x2="548.5" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="650.5" x2="650.5" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="769.5" x2="769.5" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="898" x2="898" y1="118.5938" y2="1437.4453"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1027" x2="1027" y1="118.5938" y2="1437.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="30" y="115.292">ユーザ</text><ellipse cx="54" cy="50.7969" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54,58.7969 L54,85.7969 M41,66.7969 L67,66.7969 M54,85.7969 L41,100.7969 M54,85.7969 L67,100.7969 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="42" x="30" y="1449.4404">ユーザ</text><ellipse cx="54" cy="1461.2422" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M54,1469.2422 L54,1496.2422 M41,1477.2422 L67,1477.2422 M54,1496.2422 L41,1511.2422 M54,1496.2422 L67,1511.2422 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="240.5" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="248" y="90.9951">クライアント端末</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="247.5" y="107.292">(PCまたはスマホ)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="240.5" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="248" y="1456.4404">クライアント端末</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="247.5" y="1472.7373">(PCまたはスマホ)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="508.5" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="521" y="90.9951">認証基盤</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="515.5" y="107.292">(Cognito)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="81" x="508.5" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56" x="521" y="1456.4404">認証基盤</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="515.5" y="1472.7373">(Cognito)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="599.5" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="635.5" y="90.9951">CDN</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="606.5" y="107.292">(CloudFront)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="599.5" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="635.5" y="1456.4404">CDN</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89" x="606.5" y="1472.7373">(CloudFront)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115" x="712.5" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="720.5" y="90.9951">SonicHost API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="719.5" y="107.292">(API-Gateway)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="115" x="712.5" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="720.5" y="1456.4404">SonicHost API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="101" x="719.5" y="1472.7373">(API-Gateway)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="849" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="856" y="90.9951">SPA資材格納</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="884" y="107.292">(S3)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="849" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="856" y="1456.4404">SPA資材格納</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="884" y="1472.7373">(S3)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="957" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="964" y="90.9951">静的コンテンツ格納</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1013" y="107.292">(S3)</text><rect fill="#E2E2F0" height="46.5938" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="957" y="1436.4453"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="126" x="964" y="1456.4404">静的コンテンツ格納</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="1013" y="1472.7373">(S3)</text><rect fill="#FFFFFF" height="1278.7188" style="stroke:#181818;stroke-width:1.0;" width="10" x="299" y="149.7266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="544" y="616.3906"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="544" y="718.9219"/><rect fill="#FFFFFF" height="57.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="163.7266"/><rect fill="#FFFFFF" height="204.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="826.3203"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="1183.7813"/><rect fill="#FFFFFF" height="42" style="stroke:#181818;stroke-width:1.0;" width="10" x="646" y="1328.3125"/><rect fill="#FFFFFF" height="176.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="765" y="840.3203"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="765" y="1342.3125"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="893" y="192.8594"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="1022" y="1197.7813"/><polygon fill="#181818" points="287,145.7266,297,149.7266,287,153.7266,291,149.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="149.7266" y2="149.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="61" y="144.6606">管理画面起動</text><polygon fill="#181818" points="634,159.7266,644,163.7266,634,167.7266,638,163.7266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="640" y1="163.7266" y2="163.7266"/><polygon fill="#181818" points="881,188.8594,891,192.8594,881,196.8594,885,192.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="656" x2="887" y1="192.8594" y2="192.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="663" y="187.7935">バンドル資材要求</text><polygon fill="#181818" points="667,202.8594,657,206.8594,667,210.8594,663,206.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="897" y1="206.8594" y2="206.8594"/><polygon fill="#181818" points="320,216.8594,310,220.8594,320,224.8594,316,220.8594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="314" x2="650" y1="220.8594" y2="220.8594"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="249.9922" y2="249.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="249.9922" y2="262.9922"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="262.9922" y2="262.9922"/><polygon fill="#181818" points="320,258.9922,310,262.9922,320,266.9922,316,262.9922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="316" y="244.9263">バンドル資材読み込み</text><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="292.125" y2="292.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="292.125" y2="305.125"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="305.125" y2="305.125"/><polygon fill="#181818" points="320,301.125,310,305.125,320,309.125,316,305.125" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="316" y="287.0591">トークンチェック</text><path d="M10,320.125 L76,320.125 L76,327.2578 L66,337.2578 L10,337.2578 L10,320.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="478.0625" style="stroke:#000000;stroke-width:1.5;" width="589.5" x="10" y="320.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="25" y="333.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="231" x="91" y="332.3354">[トークン取得失敗 or トークンチェック失敗]</text><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="358.3906" y2="358.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="358.3906" y2="371.3906"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="371.3906" y2="371.3906"/><polygon fill="#181818" points="320,367.3906,310,371.3906,320,375.3906,316,371.3906" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="316" y="353.3247">ログイン画面表示</text><path d="M20,386.3906 L86,386.3906 L86,393.5234 L76,403.5234 L20,403.5234 L20,386.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="186.7344" style="stroke:#000000;stroke-width:1.5;" width="520" x="20" y="386.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="399.4575">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="120" x="101" y="398.6011">[パスワード忘れた場合]</text><polygon fill="#181818" points="287,435.7891,297,439.7891,287,443.7891,291,439.7891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="439.7891" y2="439.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="61" y="419.5903">「パスワードを忘れた場合はこちら」</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="61" y="434.7231">をクリック</text><rect fill="#ADFF2F" height="23" style="stroke:#181818;stroke-width:0.5;" width="216" x="314" y="452.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="318" y="468.856">パスワードリマインダフローを参照</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="20" x2="540" y1="481.9219" y2="481.9219"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="109" x="25" y="492.1323">[新規会員登録の場合]</text><polygon fill="#181818" points="287,527.9922,297,531.9922,287,535.9922,291,531.9922" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="531.9922" y2="531.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="61" y="511.7935">「会員登録はこちら」</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="61" y="526.9263">をクリック</text><rect fill="#ADFF2F" height="23" style="stroke:#181818;stroke-width:0.5;" width="138" x="314" y="544.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="318" y="561.0591">会員登録フローを参照</text><polygon fill="#181818" points="532,612.3906,542,616.3906,532,620.3906,536,616.3906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="538" y1="616.3906" y2="616.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="316" y="596.1919">ログイン確立要求</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="87" x="316" y="611.3247">(Initiate Auth)</text><polygon fill="#181818" points="320,641.5234,310,645.5234,320,649.5234,316,645.5234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="314" x2="548" y1="645.5234" y2="645.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61" x="326" y="640.4575">session等</text><polygon fill="#181818" points="287,670.6563,297,674.6563,287,678.6563,291,674.6563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="674.6563" y2="674.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="61" y="669.5903">ユーザ名・パスワード入力</text><polygon fill="#181818" points="532,714.9219,542,718.9219,532,722.9219,536,718.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="538" y1="718.9219" y2="718.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="316" y="698.7231">認証(トークン発行依頼)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192" x="316" y="713.856">(Responed to Auth Challenge)</text><polygon fill="#181818" points="320,744.0547,310,748.0547,320,752.0547,316,748.0547" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="314" x2="548" y1="748.0547" y2="748.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="326" y="742.9888">トークン</text><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="777.1875" y2="777.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="777.1875" y2="790.1875"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="790.1875" y2="790.1875"/><polygon fill="#181818" points="320,786.1875,310,790.1875,320,794.1875,316,790.1875" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="316" y="772.1216">トークンチェック</text><polygon fill="#181818" points="634,822.3203,644,826.3203,634,830.3203,638,826.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="640" y1="826.3203" y2="826.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="98" x="316" y="821.2544">規約チェックAPI</text><polygon fill="#181818" points="753,836.3203,763,840.3203,753,844.3203,757,840.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="656" x2="759" y1="840.3203" y2="840.3203"/><rect fill="#87CEEB" height="53" style="stroke:#181818;stroke-width:0.5;" width="445" x="661" y="853.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="281" x="665" y="869.3872">CORS回避のため、API打鍵はCloudFrontを通す</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="665" y="884.52">また、API-GWでCognitoのトークンチェックも実施する。</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="437" x="665" y="899.6528">1つだけ丁寧に記載するが、以降はトークンチェック等のシーケンスを省略</text><line style="stroke:#181818;stroke-width:1.0;" x1="775" x2="817" y1="932.8516" y2="932.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="817" x2="817" y1="932.8516" y2="945.8516"/><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="817" y1="945.8516" y2="945.8516"/><polygon fill="#181818" points="786,941.8516,776,945.8516,786,949.8516,782,945.8516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="782" y="927.7856">トークンチェック</text><line style="stroke:#181818;stroke-width:1.0;" x1="775" x2="817" y1="990.1172" y2="990.1172"/><line style="stroke:#181818;stroke-width:1.0;" x1="817" x2="817" y1="990.1172" y2="1003.1172"/><line style="stroke:#181818;stroke-width:1.0;" x1="776" x2="817" y1="1003.1172" y2="1003.1172"/><polygon fill="#181818" points="786,999.1172,776,1003.1172,786,1007.1172,782,1003.1172" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="782" y="969.9185">ユーザの規約</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="782" y="985.0513">状態を確認</text><polygon fill="#181818" points="667,1013.1172,657,1017.1172,667,1021.1172,663,1017.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="769" y1="1017.1172" y2="1017.1172"/><polygon fill="#181818" points="320,1027.1172,310,1031.1172,320,1035.1172,316,1031.1172" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="314" x2="650" y1="1031.1172" y2="1031.1172"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="1060.25" y2="1060.25"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="1060.25" y2="1073.25"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="1073.25" y2="1073.25"/><polygon fill="#181818" points="320,1069.25,310,1073.25,320,1077.25,316,1073.25" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="221" x="316" y="1055.1841">元々表示しようとしていた画面を表示</text><path d="M20,1088.25 L86,1088.25 L86,1095.3828 L76,1105.3828 L20,1105.3828 L20,1088.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="332.1953" style="stroke:#000000;stroke-width:1.5;" width="1087" x="20" y="1088.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="21" x="35" y="1101.3169">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="120" x="101" y="1100.4604">[新規の規約未確認状態]</text><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="1141.6484" y2="1141.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="1141.6484" y2="1154.6484"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="1154.6484" y2="1154.6484"/><polygon fill="#181818" points="320,1150.6484,310,1154.6484,320,1158.6484,316,1154.6484" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="316" y="1121.4497">規約画面表示</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="316" y="1136.5825">全画面モーダル</text><polygon fill="#181818" points="634,1179.7813,644,1183.7813,634,1187.7813,638,1183.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="640" y1="1183.7813" y2="1183.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="78" x="316" y="1178.7153">規約情報取得</text><polygon fill="#181818" points="1010,1193.7813,1020,1197.7813,1010,1201.7813,1014,1197.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="656" x2="1016" y1="1197.7813" y2="1197.7813"/><polygon fill="#181818" points="667,1207.7813,657,1211.7813,667,1215.7813,663,1211.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="1026" y1="1211.7813" y2="1211.7813"/><polygon fill="#181818" points="320,1221.7813,310,1225.7813,320,1229.7813,316,1225.7813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="314" x2="650" y1="1225.7813" y2="1225.7813"/><polygon fill="#181818" points="287,1266.0469,297,1270.0469,287,1274.0469,291,1270.0469" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="1270.0469" y2="1270.0469"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="61" y="1249.8481">規約同意</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="61" y="1264.981">チェックボックス押下</text><polygon fill="#181818" points="287,1295.1797,297,1299.1797,287,1303.1797,291,1299.1797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="54" x2="293" y1="1299.1797" y2="1299.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="143" x="61" y="1294.1138">「確認した」ボタン押下</text><polygon fill="#181818" points="634,1324.3125,644,1328.3125,634,1332.3125,638,1328.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="640" y1="1328.3125" y2="1328.3125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="316" y="1323.2466">規約同意日時更新API</text><polygon fill="#181818" points="753,1338.3125,763,1342.3125,753,1346.3125,757,1342.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="656" x2="759" y1="1342.3125" y2="1342.3125"/><polygon fill="#181818" points="667,1352.3125,657,1356.3125,667,1360.3125,663,1356.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="661" x2="769" y1="1356.3125" y2="1356.3125"/><polygon fill="#181818" points="320,1366.3125,310,1370.3125,320,1374.3125,316,1370.3125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="314" x2="650" y1="1370.3125" y2="1370.3125"/><line style="stroke:#181818;stroke-width:1.0;" x1="309" x2="351" y1="1399.4453" y2="1399.4453"/><line style="stroke:#181818;stroke-width:1.0;" x1="351" x2="351" y1="1399.4453" y2="1412.4453"/><line style="stroke:#181818;stroke-width:1.0;" x1="310" x2="351" y1="1412.4453" y2="1412.4453"/><polygon fill="#181818" points="320,1408.4453,310,1412.4453,320,1416.4453,316,1412.4453" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="316" y="1394.3794">規約画面のモーダルを閉じる</text><!--MD5=[d8a11f86ef6363a6c7b5f0fccf22ba41]
@startuml
title ログイン


' アクター定義
actor "ユーザ" as user
participant "クライアント端末\n(PCまたはスマホ)" as device
participant "認証基盤\n(Cognito)" as cognito
participant "CDN\n(CloudFront)" as cdn
participant "SonicHost API\n(API-Gateway)" as api
participant "SPA資材格納\n(S3)" as spa
participant "静的コンテンツ格納\n(S3)" as static

' 起動
user -> device ++ : 管理画面起動
device -> cdn ++
cdn -> spa ++ : バンドル資材要求
cdn <- spa - -
device <- cdn - -
device ->device : バンドル資材読み込み
device -> device: トークンチェック
' トークンチェック
alt トークン取得失敗 or トークンチェック失敗
    device -> device : ログイン画面表示
    alt パスワード忘れた場合
        user -> device : 「パスワードを忘れた場合はこちら」\nをクリック
        rnote right of device #GreenYellow
            パスワードリマインダフローを参照
        end note
    else 新規会員登録の場合
        user -> device: 「会員登録はこちら」\nをクリック
        rnote right of device #GreenYellow
            会員登録フローを参照
        end note
    end 
    device -> cognito ++ : ログイン確立要求\n(Initiate Auth)
    device <- - cognito - - : session等
    user -> device : ユーザ名・パスワード入力
    device -> cognito ++ : 認証(トークン発行依頼)\n(Responed to Auth Challenge)
    device <- - cognito - - : トークン
    device -> device : トークンチェック
end 
' 規約確認
device -> cdn ++ : 規約チェックAPI
cdn -> api ++
rnote right of cdn #SkyBlue
    CORS回避のため、API打鍵はCloudFrontを通す
    また、API-GWでCognitoのトークンチェックも実施する。
    1つだけ丁寧に記載するが、以降はトークンチェック等のシーケンスを省略
end note
api -> api : トークンチェック
api -> api : ユーザの規約\n状態を確認
cdn <- api - -
device <- cdn - -
device -> device : 元々表示しようとしていた画面を表示
alt 新規の規約未確認状態
    device -> device : 規約画面表示\n全画面モーダル
    device -> cdn ++ : 規約情報取得
    cdn -> static ++ 
    cdn <- static - -
    device <- cdn - -
    user -> device : 規約同意\nチェックボックス押下
    user -> device : 「確認した」ボタン押下
    device -> cdn ++ : 規約同意日時更新API
    cdn -> api ++ 
    cdn <- api - -
    device <- cdn - -
    device -> device : 規約画面のモーダルを閉じる
end
@enduml

@startuml
title ログイン


actor "ユーザ" as user
participant "クライアント端末\n(PCまたはスマホ)" as device
participant "認証基盤\n(Cognito)" as cognito
participant "CDN\n(CloudFront)" as cdn
participant "SonicHost API\n(API-Gateway)" as api
participant "SPA資材格納\n(S3)" as spa
participant "静的コンテンツ格納\n(S3)" as static

user -> device ++ : 管理画面起動
device -> cdn ++
cdn -> spa ++ : バンドル資材要求
cdn <- spa - -
device <- cdn - -
device ->device : バンドル資材読み込み
device -> device: トークンチェック
alt トークン取得失敗 or トークンチェック失敗
    device -> device : ログイン画面表示
    alt パスワード忘れた場合
        user -> device : 「パスワードを忘れた場合はこちら」\nをクリック
        rnote right of device #GreenYellow
            パスワードリマインダフローを参照
        end note
    else 新規会員登録の場合
        user -> device: 「会員登録はこちら」\nをクリック
        rnote right of device #GreenYellow
            会員登録フローを参照
        end note
    end 
    device -> cognito ++ : ログイン確立要求\n(Initiate Auth)
    device <- - cognito - - : session等
    user -> device : ユーザ名・パスワード入力
    device -> cognito ++ : 認証(トークン発行依頼)\n(Responed to Auth Challenge)
    device <- - cognito - - : トークン
    device -> device : トークンチェック
end 
device -> cdn ++ : 規約チェックAPI
cdn -> api ++
rnote right of cdn #SkyBlue
    CORS回避のため、API打鍵はCloudFrontを通す
    また、API-GWでCognitoのトークンチェックも実施する。
    1つだけ丁寧に記載するが、以降はトークンチェック等のシーケンスを省略
end note
api -> api : トークンチェック
api -> api : ユーザの規約\n状態を確認
cdn <- api - -
device <- cdn - -
device -> device : 元々表示しようとしていた画面を表示
alt 新規の規約未確認状態
    device -> device : 規約画面表示\n全画面モーダル
    device -> cdn ++ : 規約情報取得
    cdn -> static ++ 
    cdn <- static - -
    device <- cdn - -
    user -> device : 規約同意\nチェックボックス押下
    user -> device : 「確認した」ボタン押下
    device -> cdn ++ : 規約同意日時更新API
    cdn -> api ++ 
    cdn <- api - -
    device <- cdn - -
    device -> device : 規約画面のモーダルを閉じる
end
@enduml

PlantUML version 1.2022.13beta8(Unknown compile time)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>